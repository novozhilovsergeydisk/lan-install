-- Сreate structure federal_districts, regions, cities

-- Удаление старых таблиц, если они существуют
DROP TABLE IF EXISTS cities;
DROP TABLE IF EXISTS regions;
DROP TABLE IF EXISTS federal_districts;

-- Создание таблицы федеральных округов
CREATE TABLE federal_districts (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

COMMENT ON TABLE federal_districts IS 'Федеральные округа России';
COMMENT ON COLUMN federal_districts.name IS 'Название федерального округа';

-- Создание таблицы регионов
CREATE TABLE regions (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    federal_district_id INTEGER NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_federal_district
        FOREIGN KEY (federal_district_id)
        REFERENCES federal_districts(id)
        ON DELETE CASCADE
);

COMMENT ON TABLE regions IS 'Регионы России (области, республики, края)';
COMMENT ON COLUMN regions.name IS 'Название региона';
COMMENT ON COLUMN regions.federal_district_id IS 'ID федерального округа';

-- Создание таблицы городов
CREATE TABLE cities (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    region_id INTEGER NOT NULL,
    postal_code VARCHAR(10) DEFAULT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_region
        FOREIGN KEY (region_id)
        REFERENCES regions(id)
        ON DELETE CASCADE
);

COMMENT ON TABLE cities IS 'Города России';
COMMENT ON COLUMN cities.name IS 'Название города';
COMMENT ON COLUMN cities.region_id IS 'ID региона';
COMMENT ON COLUMN cities.postal_code IS 'Почтовый индекс';

-- Создание индексов для ускорения поиска
CREATE INDEX idx_cities_name ON cities (name);
CREATE INDEX idx_cities_postal_code ON cities (postal_code);
CREATE INDEX idx_regions_name ON regions (name);
CREATE INDEX idx_regions_federal_district ON regions (federal_district_id);

-- Функция для обновления поля updated_at
CREATE OR REPLACE FUNCTION update_modified_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Триггеры для обновления поля updated_at
CREATE TRIGGER update_federal_districts_modtime
BEFORE UPDATE ON federal_districts
FOR EACH ROW EXECUTE FUNCTION update_modified_column();

CREATE TRIGGER update_regions_modtime
BEFORE UPDATE ON regions
FOR EACH ROW EXECUTE FUNCTION update_modified_column();

CREATE TRIGGER update_cities_modtime
BEFORE UPDATE ON cities
FOR EACH ROW EXECUTE FUNCTION update_modified_column();

-- ************************************* END Сreate structure federal_districts, regions, cities

-- Вставка федеральных округов, регионов и городов
-- Вставка федеральных округов
INSERT INTO federal_districts (id, name) VALUES
(1, 'Центральный'),
(2, 'Северо-Западный'),
(3, 'Южный'),
(4, 'Северо-Кавказский'),
(5, 'Приволжский'),
(6, 'Уральский'),
(7, 'Сибирский'),
(8, 'Дальневосточный');

-- Вставка регионов
INSERT INTO regions (id, name, federal_district_id) VALUES
-- Центральный округ
(1, 'Москва', 1),
(2, 'Московская область', 1),
(3, 'Белгородская область', 1),
(4, 'Брянская область', 1),
(5, 'Владимирская область', 1),
(6, 'Воронежская область', 1),
(7, 'Ивановская область', 1),
(8, 'Калужская область', 1),
(9, 'Костромская область', 1),
(10, 'Курская область', 1),
(11, 'Липецкая область', 1),
(12, 'Орловская область', 1),
(13, 'Рязанская область', 1),
(14, 'Смоленская область', 1),
(15, 'Тамбовская область', 1),
(16, 'Тверская область', 1),
(17, 'Тульская область', 1),
(18, 'Ярославская область', 1),

-- Северо-Западный округ
(19, 'Санкт-Петербург', 2),
(20, 'Ленинградская область', 2),
(21, 'Архангельская область', 2),
(22, 'Вологодская область', 2),
(23, 'Калининградская область', 2),
(24, 'Республика Карелия', 2),
(25, 'Республика Коми', 2),
(26, 'Мурманская область', 2),
(27, 'Новгородская область', 2),
(28, 'Псковская область', 2),
(29, 'Ненецкий автономный округ', 2),

-- Южный округ
(30, 'Республика Адыгея', 3),
(31, 'Астраханская область', 3),
(32, 'Волгоградская область', 3),
(33, 'Республика Калмыкия', 3),
(34, 'Краснодарский край', 3),
(35, 'Ростовская область', 3),
(36, 'Севастополь', 3),
(37, 'Республика Крым', 3),

-- Северо-Кавказский округ
(38, 'Республика Дагестан', 4),
(39, 'Республика Ингушетия', 4),
(40, 'Кабардино-Балкарская Республика', 4),
(41, 'Карачаево-Черкесская Республика', 4),
(42, 'Республика Северная Осетия - Алания', 4),
(43, 'Чеченская Республика', 4),
(44, 'Ставропольский край', 4),

-- Приволжский округ
(45, 'Республика Башкортостан', 5),
(46, 'Кировская область', 5),
(47, 'Республика Марий Эл', 5),
(48, 'Республика Мордовия', 5),
(49, 'Нижегородская область', 5),
(50, 'Оренбургская область', 5),
(51, 'Пензенская область', 5),
(52, 'Пермский край', 5),
(53, 'Самарская область', 5),
(54, 'Саратовская область', 5),
(55, 'Республика Татарстан', 5),
(56, 'Удмуртская Республика', 5),
(57, 'Ульяновская область', 5),
(58, 'Чувашская Республика', 5),

-- Уральский округ
(59, 'Курганская область', 6),
(60, 'Свердловская область', 6),
(61, 'Тюменская область', 6),
(62, 'Ханты-Мансийский АО', 6),
(63, 'Челябинская область', 6),
(64, 'Ямало-Ненецкий АО', 6),

-- Сибирский округ
(65, 'Республика Алтай', 7),
(66, 'Алтайский край', 7),
(67, 'Республика Бурятия', 7),
(68, 'Забайкальский край', 7),
(69, 'Иркутская область', 7),
(70, 'Кемеровская область', 7),
(71, 'Красноярский край', 7),
(72, 'Новосибирская область', 7),
(73, 'Омская область', 7),
(74, 'Томская область', 7),
(75, 'Республика Тыва', 7),
(76, 'Республика Хакасия', 7),

-- Дальневосточный округ
(77, 'Амурская область', 8),
(78, 'Еврейская автономная область', 8),
(79, 'Камчатский край', 8),
(80, 'Магаданская область', 8),
(81, 'Приморский край', 8),
(82, 'Республика Саха (Якутия)', 8),
(83, 'Сахалинская область', 8),
(84, 'Хабаровский край', 8),
(85, 'Чукотский автономный округ', 8);

-- Вставка городов
INSERT INTO cities (id, name, region_id, postal_code) VALUES
-- Москва (1)
(1, 'Москва', 1, '101000'),

-- Московская область (2)
(2, 'Подольск', 2, '142100'),
(3, 'Мытищи', 2, '141010'),
(4, 'Люберцы', 2, '140000'),
(5, 'Химки', 2, '141400'),
(6, 'Королёв', 2, '141014'),
(7, 'Балашиха', 2, '143900'),
(8, 'Клин', 2, '141600'),
(9, 'Воскресенск', 2, '140200'),
(10, 'Домодедово', 2, '142000'),
(11, 'Жуковский', 2, '140700'),
(12, 'Коломна', 2, '140400'),
(13, 'Сергиев Посад', 2, '141300'),
(14, 'Одинцово', 2, '143000'),

-- Белгородская область (3)
(15, 'Белгород', 3, '308000'),
(16, 'Старый Оскол', 3, '309500'),
(17, 'Губкин', 3, '309180'),

-- Брянская область (4)
(18, 'Брянск', 4, '241000'),
(19, 'Клинцы', 4, '243140'),
(20, 'Сельцо', 4, '241550'),

-- Владимирская область (5)
(21, 'Владимир', 5, '600000'),
(22, 'Ковров', 5, '601900'),
(23, 'Муром', 5, '602200'),

-- Воронежская область (6)
(24, 'Воронеж', 6, '394000'),
(25, 'Борисоглебск', 6, '397160'),
(26, 'Россошь', 6, '396650'),

-- Ивановская область (7)
(27, 'Иваново', 7, '153000'),
(28, 'Кинешма', 7, '155800'),
(29, 'Шуя', 7, '155900'),

-- Калужская область (8)
(30, 'Калуга', 8, '248000'),
(31, 'Обнинск', 8, '249030'),
(32, 'Людиново', 8, '249400'),

-- Костромская область (9)
(33, 'Кострома', 9, '156000'),
(34, 'Буй', 9, '157000'),
(35, 'Шарья', 9, '157500'),

-- Курская область (10)
(36, 'Курск', 10, '305000'),
(37, 'Железногорск', 10, '307170'),
(38, 'Курчатов', 10, '307250'),

-- Липецкая область (11)
(39, 'Липецк', 11, '398000'),
(40, 'Елец', 11, '399770'),
(41, 'Грязи', 11, '399060'),

-- Орловская область (12)
(42, 'Орёл', 12, '302000'),
(43, 'Ливны', 12, '303850'),
(44, 'Мценск', 12, '303030'),

-- Рязанская область (13)
(45, 'Рязань', 13, '390000'),
(46, 'Касимов', 13, '391300'),
(47, 'Скопин', 13, '391800'),

-- Смоленская область (14)
(48, 'Смоленск', 14, '214000'),
(49, 'Вязьма', 14, '215100'),
(50, 'Рославль', 14, '216500'),

-- Тамбовская область (15)
(51, 'Тамбов', 15, '392000'),
(52, 'Мичуринск', 15, '393760'),
(53, 'Рассказово', 15, '393250'),

-- Тверская область (16)
(54, 'Тверь', 16, '170000'),
(55, 'Ржев', 16, '172380'),
(56, 'Вышний Волочёк', 16, '171150'),

-- Тульская область (17)
(57, 'Тула', 17, '300000'),
(58, 'Новомосковск', 17, '301650'),
(59, 'Щёкино', 17, '301240'),

-- Ярославская область (18)
(60, 'Ярославль', 18, '150000'),
(61, 'Рыбинск', 18, '152900'),
(62, 'Переславль-Залесский', 18, '152020'),

-- Санкт-Петербург (19)
(63, 'Санкт-Петербург', 19, '190000'),

-- Ленинградская область (20)
(64, 'Гатчина', 20, '188300'),
(65, 'Выборг', 20, '188800'),
(66, 'Всеволожск', 20, '188640'),

-- Архангельская область (21)
(67, 'Архангельск', 21, '163000'),
(68, 'Северодвинск', 21, '164500'),
(69, 'Котлас', 21, '165300'),

-- Вологодская область (22)
(70, 'Вологда', 22, '160000'),
(71, 'Череповец', 22, '162600'),
(72, 'Сокол', 22, '162100'),

-- Калининградская область (23)
(73, 'Калининград', 23, '236000'),
(74, 'Советск', 23, '238750'),
(75, 'Черняховск', 23, '238150'),

-- Республика Карелия (24)
(76, 'Петрозаводск', 24, '185000'),
(77, 'Кондопога', 24, '186220'),
(78, 'Костомукша', 24, '186930'),

-- Республика Коми (25)
(79, 'Сыктывкар', 25, '167000'),
(80, 'Ухта', 25, '169300'),
(81, 'Воркута', 25, '169900'),

-- Мурманская область (26)
(82, 'Мурманск', 26, '183000'),
(83, 'Апатиты', 26, '184200'),
(84, 'Североморск', 26, '184600'),

-- Новгородская область (27)
(85, 'Великий Новгород', 27, '173000'),
(86, 'Боровичи', 27, '174400'),
(87, 'Старая Русса', 27, '175200'),

-- Псковская область (28)
(88, 'Псков', 28, '180000'),
(89, 'Великие Луки', 28, '182100'),
(90, 'Остров', 28, '181350'),

-- Ненецкий автономный округ (29)
(91, 'Нарьян-Мар', 29, '166000'),

-- Республика Адыгея (30)
(92, 'Майкоп', 30, '385000'),
(93, 'Адыгейск', 30, '385200'),

-- Астраханская область (31)
(94, 'Астрахань', 31, '414000'),
(95, 'Ахтубинск', 31, '416500'),
(96, 'Знаменск', 31, '416540'),

-- Волгоградская область (32)
(97, 'Волгоград', 32, '400000'),
(98, 'Волжский', 32, '404100'),
(99, 'Камышин', 32, '403870'),

-- Республика Калмыкия (33)
(100, 'Элиста', 33, '358000'),

-- Краснодарский край (34)
(101, 'Краснодар', 34, '350000'),
(102, 'Сочи', 34, '354000'),
(103, 'Новороссийск', 34, '353900'),
(104, 'Армавир', 34, '352900'),

-- Ростовская область (35)
(105, 'Ростов-на-Дону', 35, '344000'),
(106, 'Таганрог', 35, '347900'),
(107, 'Шахты', 35, '346500'),
(108, 'Новочеркасск', 35, '346400'),

-- Севастополь (36)
(109, 'Севастополь', 36, '299000'),

-- Республика Крым (37)
(110, 'Симферополь', 37, '295000'),
(111, 'Керчь', 37, '298300'),
(112, 'Евпатория', 37, '297400'),
(113, 'Ялта', 37, '298600'),

-- Республика Дагестан (38)
(114, 'Махачкала', 38, '367000'),
(115, 'Хасавюрт', 38, '368000'),
(116, 'Дербент', 38, '368600'),

-- Республика Ингушетия (39)
(117, 'Магас', 39, '386000'),
(118, 'Назрань', 39, '386100'),

-- Кабардино-Балкарская Республика (40)
(119, 'Нальчик', 40, '360000'),
(120, 'Прохладный', 40, '361000');

